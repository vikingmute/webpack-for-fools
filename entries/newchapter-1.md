## Webpackå‚»ç“œå¼æŒ‡å—

**å¤§çº¦ä¸€å¹´å‰æˆ‘å†™äº†ç¬¬ä¸€ç‰ˆçš„ webpack å‚»ç“œæŒ‡å—ï¼Œå½“æ—¶åªæ˜¯æƒ³å†™ä¸€ç¯‡æ–¹ä¾¿å¤§å®¶ç†è§£é€šä¿—æ˜“æ‡‚çš„æ–‡ç« ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œåœ¨è¿™ä¸€å¹´å†…æˆ‘å’Œæœ‹å‹å‡ºäº†ä¸€æœ¬åå« Reactå…¨æ ˆ çš„ä¹¦ï¼ŒåŒæ—¶æˆ‘ä¹Ÿåœ¨æ€è€ƒåœ¨å½“å‰å„ç§å‰ç«¯åŸ¹è®­é±¼é¾™æ··æ‚çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆæ­£ç¡®çš„æ–¹æ³•è®©å¤§å¯¹å‰ç«¯å¼€å‘æ„Ÿå…´è¶£çš„äººè·å–çŸ¥è¯†ï¼ŒåŒæ—¶ webpack2 çš„æ¨å‡ºï¼Œè®©åŸæ¥æ•™ç¨‹çš„ä¸€å¤§éƒ¨åˆ†éƒ½å·²ç»ä¸å†é€‚ç”¨ï¼Œæ‰€ä»¥æˆ‘æƒ³å¯ä»¥æ›´æ–°ä¸€ä¸ªæ–°çš„å‚»ç“œæ•™ç¨‹ï¼Œè®©å¤§å®¶æ„Ÿå—ä¸€äº›æ–°ç‰ˆ webpack çš„é­…åŠ›**

## ç¬¬ä¸€ç« ï¼šWebpack ç¼˜èµ·å’Œå…¥é—¨

### 1.1 æ¨¡å—åŒ–å¼€å‘

ES6 ä¹‹å‰ï¼ŒJavascript å¹¶æ²¡æœ‰åŸç”Ÿçš„æ¨¡å—çš„ï¼ŒJavascript å¼€å‘è€…é€šè¿‡å„ç§çº¦å®šæˆ–å¦¥åå®ç°äº†æ¨¡å—çš„ç‰¹å¾ï¼Œå¦‚ç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œæš´éœ²å±æ€§ä¸æ–¹æ³•çš„èƒ½åŠ›ç­‰ã€‚ç²—ç•¥åˆ†æçš„è¯ï¼Œè¿™ä¸€è¿‡ç¨‹å¤§è‡´ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼šå…¨å±€å˜é‡ + å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼ŒAMD ï¼Œ CommonJSï¼ŒES6 æ¨¡å—ã€‚è¿™éƒ¨åˆ†æˆ‘å°±ä¸å±•å¼€è®²äº†ã€‚è¿™é‡Œè¦è¯´çš„å°±æ˜¯éšç€ Node.js çš„å‡ºç°ï¼Œ Common.js çš„å‡ºç°ï¼Œç»™æ¨¡å—å¼€å‘å¸¦æ¥äº†æ–°çš„æ–¹æ³•å’Œæ€è·¯ã€‚

```javascript
var path = require('path')
console.log(path)
```

æƒ³æ³•æ˜¯ç¾å¥½çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¹¶ä¸é€‚ç”¨æµè§ˆå™¨ç¯å¢ƒï¼Œå•çº¿ç¨‹çš„ Javascript å¯ä»¥ä½¿ç”¨ä¸€äº›å¦ç±»çš„æ–¹æ³•å®Œæˆè¿™äº›å·¥ä½œï¼Œæ¯”å¦‚åŠ¨æ€åŠ è½½ä¸€ä¸ª script æˆ–è€…ä½¿ç”¨ XHRï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ­¥çš„åŠ è½½ä¸€ä¸ª Javascript æ–‡ä»¶ï¼Œä½†æ˜¯ä¼šç›´æ¥ block ä½åé¢ä»£ç çš„æ‰§è¡Œã€‚

```javascript
//xhr
$.getScript("my_lovely_script.js", function(){
   alert("Script loaded but not necessarily executed.");
});
```
å¼‚æ­¥åŠ è½½ script çš„æ–¹æ³•ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¿…é¡»åœ¨å›è°ƒæ–¹æ³•ä¸­æ‰èƒ½ä½¿ç”¨ï¼Œæœ‰æ²¡æœ‰æ€æ ·ä¸€ç§æ–¹æ³•èƒ½å¤Ÿåƒ Node.js ä¸€æ ·è¿›è¡Œæ¨¡å—åŒ–å¼€å‘å‘¢ã€‚å‡å¦‚æˆ‘ä»¬æ‰€å†™çš„æµè§ˆå™¨ç«¯ä»£ç ä¹Ÿé‡‡ç”¨ common.js çš„æ–¹æ³•ï¼Œç”šè‡³èƒ½åšåˆ°å‰åç«¯åŒç”¨ä¸€å¥—ä»£ç ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ

### 1.2 ä½¿ç”¨ webpackï¼Œå®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­

>>> æœ¬èŠ‚ä»£ç å¯ä»¥å‚è§ /codes/part1/

ä¸Šé¢æå‡ºäº†ä¸€ä¸ªéš¾é¢˜ï¼Œç®€å•æ¥è¯´ webpack å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆå½“ç„¶å®ƒçš„åŠŸèƒ½è¿œè¿œè¶…è¿‡è¿™ä¸ªï¼‰ã€‚ å…ˆæ¥å®‰è£…ä¸€ä¸‹ï¼Œæˆ‘åœ¨è¿™é‡Œå»ºè®®å¤§å®¶è‡³å°‘ä½¿ç”¨ node  6.0.0 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚

```bash
npm install webpack -g
```
ç›®å‰ webpack çš„ç‰ˆæœ¬ä¸º 2.3.3

åˆ›å»ºç¬¬ä¸€ä¸ªç§°ä¸º hello.js çš„æ¨¡å—

Webpack å¤©ç”Ÿæ”¯æŒ ES6 import å’Œ export çš„æ¨¡å—è¯­æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ common.js æ¥å†™ã€‚

åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ã€‚

```javascript
//hello.js
export default function () {
    alert('from anohter planet')
}
```

```javascript
//index.js
import hello from './hello'
//è°ƒç”¨è¿™ä¸ªæ–¹æ³•
hello()
```
å½“ç„¶ç°åœ¨å¦‚æœç›´æ¥åœ¨ html é¡µé¢é‡Œé¢å¼•ç”¨ index.js æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œæµè§ˆå™¨æ˜¯æ— æ³•å¤„ç† ES6 æ¨¡å—æˆ–è€…æ˜¯ common.js è§„èŒƒçš„ã€‚
é‚£ä¹ˆç°åœ¨ä½¿ç”¨ webpack æ¥å¤„ç†æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ã€‚ä½¿ç”¨ webpack cli å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œå°±æ˜¯ index.js, ç¬¬äºŒä¸ªæ˜¯è¾“å‡ºæ–‡ä»¶çš„åå­—ï¼Œè¿™é‡Œå‘½åä¸º bundle.jsï¼Œæš‚æ—¶ä¸ç®¡ bundle.js é‡Œé¢æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œåšäº†å“ªäº›å·¥ä½œï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“å°±æ˜¯ webpack ä½¿ç”¨ä¸€å®šçš„é­”åŠ›ï¼ŒæŠŠä¸¤ä¸ªæ–‡ä»¶çš„ä¾èµ–å’Œè¿è¡Œåœ¨ bundle.js å®Œæˆäº†ã€‚

```bash
webpack index.js bundle.js
```
ç°åœ¨å‘ç° bundle.js è¢«åˆ›å»ºå‡ºæ¥ï¼Œå†åˆ›å»ºä¸€ä¸ª html é¡µé¢æ¥å¼•ç”¨å®ƒã€‚

```html
<html>
  <head>
    <title> Our first webpack exmaple </title>
  </head>
  <body>
    <script src="bundle.js"></script>
  </body>
</html>
```
ç°åœ¨ç”¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ª html é¡µé¢ï¼Œå‘ç° alert å‡ºç°äº†ï¼Œä»»åŠ¡å®Œæˆï¼Œåº†ç¥ä¸€ä¸‹ï¼æˆ‘ä»¬å¯ä»¥ç”¨ ES6 æ¥å®Œæˆæ¨¡å—åŒ–å¼€å‘å•¦ã€‚

### 1.3 ä½¿ç”¨é…ç½®æ–‡ä»¶

>>> æœ¬èŠ‚ä»£ç å¯ä»¥å‚è§ /codes/part2/

ç°åœ¨æ¯æ¬¡éƒ½è¦ä½¿ç”¨ *webpack index.js bundle.js* å‘½ä»¤æ¥ç”Ÿæˆæ–‡ä»¶ï¼Œè¿™ç§æ¯æ¬¡éƒ½è¦åŠ å‚æ•°çš„åšæ³•æ˜¯ç¨‹åºå‘˜ç—›æ¨çš„ï¼Œwebpack æä¾›é…ç½®æ–‡ä»¶å¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆè¿™é¡¹å·¥ä½œã€‚

åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ–°å»º *webpack.config.js* æ–‡ä»¶

```javascript
module.exports = {
    // å…¥å£æ–‡ä»¶åç§°
    entry: './index.js',
    // è¾“å‡ºæ–‡ä»¶åç§°
    output: {
        filename: 'bundle.js'
    }
}
```
ç„¶ååœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œ

```bash
webpack
```

ç„¶åå‘ç°é…ç½®æ–‡ä»¶æˆåŠŸï¼Œæ–‡ä»¶ç”ŸæˆæˆåŠŸå•¦ï¼

### 1.4 ä½¿ç”¨ Loader

>>> æœ¬èŠ‚ä»£ç å¯ä»¥å‚è§ /codes/part3/

ä¸Šé¢çš„ä¾‹å­å¸®æˆ‘ä»¬äº†è§£äº† webpack æœ€åŸºæœ¬çš„å·¥ä½œæ–¹å¼ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹ webpack çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œåœ¨å¼€å§‹ Loader ä¹‹å‰ï¼Œè¦å…ˆçŸ¥é“å¦å¤–ä¸€ä¸ªæ¦‚å¿µ *module*ï¼Œä¸Šé¢å·²ç»è¯´è¿‡äº†è¿™ä¸ª moduleï¼ˆæ¨¡å—ï¼‰ï¼Œä¸Šé¢æ‰€è¯´çš„å°±æ˜¯ common.js æˆ–è€…è¯´æ˜¯ ES2015æ ¼å¼çš„import/export çš„æ¨¡å—ï¼Œåœ¨ webpack ä¸­è¿™ä¸¤ç§ç±»å‹çš„æ–‡ä»¶æ˜¯å¤©ç”Ÿæ”¯æŒçš„ï¼Œä½†æ˜¯ webpack å¯ä»¥å¼•å…¥çš„ moduleï¼Œè¿œè¿œä¸æ­¢è¿™äº›ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ ·å¼æ–‡ä»¶ï¼ˆlessï¼cssï¼sassï¼‰æˆ–è€…æ˜¯ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼ˆjpgï¼pngï¼webpç­‰ç­‰ï¼‰æˆ–è€…æ˜¯ svgæ–‡ä»¶ è¿˜å¯èƒ½æ˜¯ coffeescriptï¼typescript ç±»å‹ï¼Œä½ å¬åˆ°è¿™é‡Œä¹Ÿè®¸æœ‰ç‚¹éœ‡æƒŠï¼Œåœ¨jsæ–‡ä»¶ä¸­å¼•è¿›ä¸€ä¸ªæ ·å¼æ–‡ä»¶ï¼Ÿåº”è¯¥æ²¡æœ‰äººä¼šè¿™æ ·åšå§ï¼Œé‚£å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯•è¯•å§ã€‚

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ style.css
```css
body {
    background: yellow;
}
```

åœ¨ index.js ä¸­ç›´æ¥å¼•å…¥è¿™ä¸ªæ–‡ä»¶

```javascript
//index.js
import hello from './hello'
// å¼•å…¥æ ·å¼æ–‡ä»¶
import './style.css'

hello()
```

ç„¶åè¿è¡Œ webpack å‘½ä»¤ï¼Œå‘ç°å‡ºç°äº†ä¸€è¡Œé”™è¯¯ï¼Œçœ‹æ¥æˆ‘ä»¬è¿˜æ˜¯å¤ªå¤©çœŸäº†ã€‚

```
ERROR in ./style.css
Module parse failed: /Users/vzhang/Public/webpack-for-fools/codes/part3/style.css Unexpected token (1:5)
You may need an appropriate loader to handle this file type.
| body {
|     background:yellow;
| }
 @ ./index.js 2:0-20
```

ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯éœ€è¦ä¸€ä¸ªåˆé€‚çš„loaderæ¥å¤„ç†è¿™ä¸ªç±»å‹çš„æ–‡ä»¶(cssæ–‡ä»¶)ã€‚webpackå¯ä»¥è‡ªåŠ¨å¤„ç†jsç±»å‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯cssæ–‡ä»¶å®ƒä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†ï¼Œè¿™é‡Œä¼Ÿå¤§çš„loaderå°±å‡ºç°äº†ï¼Œå…¶å®é€šä¿—æ¥è¯´ loader å°±æ˜¯ä¸€ç³»åˆ—çš„æ’ä»¶æ¥å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æˆåŠŸçš„å¼•å…¥ä½ çš„æ–‡ä»¶ä¸­ã€‚ **Loaders describe to webpack how to process non-JavaScript modules and include these dependencies into your bundles.**

åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ,æ¥å®‰è£…å¤„ç†cssæ–‡ä»¶éœ€è¦çš„ä¸¤ä¸ªLoaderï¼š

```bash
npm install style-loader css-loader --save-dev
```

æ·»åŠ å®Œè¿™ä¸¤ä¸ªloaderä¹‹åï¼Œæˆ‘ä»¬è¦æ•™ä¼š webpack ç”¨ä»€ä¹ˆLoaderå¤„ç†ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ã€‚åœ¨ webpack.config.js ä¸­ä¿®æ”¹ï¼š

```javascript
module.exports = {
    // å…¥å£æ–‡ä»¶åç§°
    entry: './index.js',
    // è¾“å‡ºæ–‡ä»¶åç§°
    output: {
        filename: 'bundle.js'
    },
    // è¿™é‡Œæ˜¯æˆ‘ä»¬æ–°æ·»åŠ çš„å¤„ç†ä¸åŒç±»å‹æ–‡ä»¶éœ€è¦çš„ Loader
    module: {
    	rules: [
    		{ test: /\.css$/, use: [ { loader: 'style-loader' }, { loader: 'css-loader' } ]}
    	]
    }
}
```

ä»”ç»†åˆ†æä¸€ä¸‹è¿™ä¸€å¥è¯­æ³•ï¼š
```javascript
{ test: /\.css$/, use: [ { loader: 'style-loader' }, { loader: 'css-loader' } ]}
```
å‰é¢ test ä¼ å…¥ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»£è¡¨ä½ è¦å¤„ç†ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯åç¼€åä¸º.cssçš„æ–‡ä»¶ï¼Œåé¢çš„ use ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œä»£è¡¨ç€è¿™ä¸ªæ–‡ä»¶ä¼šè¢«è¿™ä¸¤ä¸ªloaderæ‰€å¤„ç†ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥è¢« **å¤šä¸ªloader** æ‰€å¤„ç†:
>>> Loaders can be chained. They are applied in a pipeline to the resource. A chain of loaders are compiled chronologically. The first loader in a chain of loaders returns a value to the next. At the end loader, webpack expects JavaScript to be returned.

è¯»è€…ä¹Ÿè®¸ä¼šé—®å¤„ç† css æ–‡ä»¶ä¸€ä¸ª css-loader ä¸å°±å¤Ÿäº†å—ï¼Ÿ é‚£ä¹ˆ style-loader æ˜¯åšä»€ä¹ˆçš„ï¼Ÿè¿™é‡Œå…ˆå–ä¸€ä¸ªå°å…³å­ï¼Œä¹‹åä¼šè§£é‡ŠåŸå› ã€‚

é…ç½®æ–‡ä»¶æ”¹å¥½ä»¥åï¼Œè¿è¡Œ webpack å‘½ä»¤ã€‚è¿™æ¬¡æ²¡æœ‰æŠ¥é”™ï¼Œbundle.js æ–‡ä»¶ç”Ÿæˆäº†ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ index.html ,å‘ç°é¡µé¢çš„èƒŒæ™¯å˜æˆäº†é»„è‰²ï¼Œloader è¿è¡ŒæˆåŠŸäº†ï¼å¯ä»¥åº†ç¥ä¸€ä¸‹å»å–æ¯ğŸºå•¦ï¼
